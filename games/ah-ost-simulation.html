<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>American Studies — Game 7: OST Simulation Mixer (Mastery)</title>

  <link rel="stylesheet" href="../styles.css">

  <!-- Hardened fallback so it never looks “blank” -->
  <style>
    :root{
      --bg:#0b1220; --text:#e7eefc; --muted:#a8b4cf;
      --line:rgba(255,255,255,.12); --radius:18px;
      --accent:#7aa2ff; --good:#2bd576; --bad:#ff5c7a; --warn:#ffd166;
    }
    body{
      margin:0;
      background:radial-gradient(1200px 800px at 30% 10%, rgba(122,162,255,.18), transparent 60%), var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:18px;
    }
    .gameShell{ width:min(980px,100%); }
    .panel{
      background:rgba(17,26,47,.72);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:0 12px 35px rgba(0,0,0,.25);
      padding:16px;
    }
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between}
    .kpis{display:flex; gap:10px; flex-wrap:wrap}
    .kpi{
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:rgba(255,255,255,.05);
      color:var(--muted);
      font-size:13px;
    }
    .kpi strong{color:var(--text)}
    .title{font-weight:900; font-size:18px}
    .desc{color:var(--muted); margin-top:2px; font-size:13px}
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--muted);
      font-size:13px;
      margin-top:8px;
    }
    .hr{height:1px; background:var(--line); margin:14px 0}

    .qwrap{margin-top:14px}
    .qmeta{display:flex; gap:10px; flex-wrap:wrap; color:var(--muted); font-size:13px}
    .stem{margin-top:10px; font-size:18px; line-height:1.35; font-weight:900;}
    .miniTag{
      display:inline-block;
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--line);
      border-radius:999px;
      padding:4px 8px;
      margin-top:10px;
      background:rgba(0,0,0,.15);
    }

    .choices{display:grid; gap:10px; margin-top:12px}
    .choice{
      text-align:left;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      cursor:pointer;
      transition:transform .08s ease, border-color .12s ease, background .12s ease;
      font-size:15px;
      line-height:1.35;
    }
    .choice:hover{transform:translateY(-1px); border-color:rgba(122,162,255,.35)}
    .choice[disabled]{opacity:.55; cursor:not-allowed; transform:none}

    .msg{
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:rgba(0,0,0,.18);
      color:var(--muted);
      line-height:1.45;
    }
    .msg.good{border-color:rgba(43,213,118,.35)}
    .msg.bad{border-color:rgba(255,92,122,.35)}
    .msg.warn{border-color:rgba(255,209,102,.35)}
    .msgTitle{font-weight:900; margin-bottom:6px; color:var(--text)}

    .hintBox{
      margin-top:10px;
      border:1px dashed rgba(255,209,102,.45);
      border-radius:14px;
      padding:10px 12px;
      background:rgba(255,209,102,.06);
      color:var(--muted);
      display:none;
    }

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
    }
    .btn:hover{border-color:rgba(122,162,255,.35)}
    .btn.primary{background:rgba(122,162,255,.18); border-color:rgba(122,162,255,.35)}
    .btn.good{background:rgba(43,213,118,.14); border-color:rgba(43,213,118,.35)}
    .btn.bad{background:rgba(255,92,122,.12); border-color:rgba(255,92,122,.35)}
    .btn[disabled]{opacity:.5; cursor:not-allowed}

    .nameGate{display:grid; gap:10px; margin-top:10px;}
    input[type="text"]{
      width:min(420px,100%);
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      outline:none;
      font-size:15px;
    }

    .finishCard{
      margin-top:14px;
      padding:14px;
      border-radius:18px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
    }
    .code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:13px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      overflow:auto;
      white-space:pre-wrap;
    }
    .small{font-size:13px; color:var(--muted)}
  </style>
</head>

<body>
  <div class="gameShell">
    <div class="panel">

      <div class="row">
        <div>
          <div class="title">American Studies — Game 7</div>
          <div class="desc">OST Simulation Mixer • Mixed stems • 100% mastery required</div>
          <div class="pill">Directions: Choose the best answer. Wrong answer = hint; miss counts once; mastery requires 100%.</div>
        </div>
        <div class="kpis">
          <div class="kpi"><strong>Name:</strong> <span id="nameOut">—</span></div>
          <div class="kpi"><strong>Score:</strong> <span id="scoreOut">0 / 0</span></div>
          <div class="kpi"><strong>Accuracy:</strong> <span id="accOut">0%</span></div>
          <div class="kpi"><strong>Progress:</strong> <span id="progOut">0 / 0</span></div>
        </div>
      </div>

      <div class="hr"></div>

      <!-- NAME GATE -->
      <div id="gate">
        <div class="msg warn">
          <div class="msgTitle">Start</div>
          <div>Enter your name to begin. Questions are randomized each run. Mastery requires <strong>100% accuracy</strong> across all questions.</div>
        </div>
        <div class="nameGate">
          <input id="nameIn" type="text" placeholder="Student Name" maxlength="40" />
          <div class="actions">
            <button class="btn primary" id="btnStart">Start Game</button>
          </div>
        </div>
      </div>

      <!-- GAME -->
      <div id="game" style="display:none;">
        <div class="qwrap">
          <div class="qmeta">
            <div><strong>Question:</strong> <span id="qNum">1</span> / <span id="qTotal">0</span></div>
            <div><strong>Attempt on this question:</strong> <span id="attemptThis">0</span></div>
          </div>

          <div class="stem" id="stem">—</div>
          <div class="miniTag" id="tag">—</div>

          <div class="choices" id="choices"></div>

          <div class="hintBox" id="hintBox"></div>

          <div class="msg" id="feedback" style="display:none;">
            <div class="msgTitle" id="fbTitle">—</div>
            <div id="fbText">—</div>
          </div>

          <div class="actions">
            <button class="btn bad" id="btnRestart">Restart Run</button>
            <button class="btn good" id="btnFinish" disabled>Finish / Submit</button>
          </div>

          <div class="small" style="margin-top:10px;">
            Mastery unlocks only when <strong>all questions are completed</strong> and <strong>accuracy is 100%</strong>.
          </div>
        </div>

        <!-- FINISH SCREEN -->
        <div id="finish" style="display:none;">
          <div class="finishCard">
            <div class="msgTitle">Run Summary</div>
            <div class="small" id="summaryLine">—</div>
            <div class="hr"></div>
            <div class="code" id="summaryCode">—</div>
            <div class="actions" style="margin-top:12px;">
              <button class="btn primary" id="btnNewRun">New Randomized Run</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
(function(){
  "use strict";

  // 30 mixed OST-style questions (single best answer)
  // Balanced answer keys across A/B/C/D.
  const questions = [
  {
    cause: "Mechanized farming increased agricultural production and made farm labor more efficient.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Many rural workers were no longer needed on farms and moved to cities for jobs.",
      B: "The federal government required families to relocate to industrial centers.",
      C: "Factory owners reduced production because fewer workers were available.",
      D: "Cities banned new housing construction to slow population growth."
    },
    effect: "Urban areas grew rapidly as more people shifted from rural living to urban living.",
    answer: "A",
    hint: "One link explains why people LEFT farms.",
    explain: "Mechanized farming reduced the need for rural labor, pushing people to cities and accelerating urban growth."
  },
  {
    cause: "Industrialization increased the demand for workers in industrial centers.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Immigrants came from other countries to take jobs in industrial centers.",
      B: "The U.S. ended all immigration to prevent overcrowding.",
      C: "Most factories relocated to rural farmland to avoid cities.",
      D: "Workers abandoned wage labor for subsistence farming."
    },
    effect: "Mass immigration helped fill a demand for workers and increased diversity.",
    answer: "A",
    hint: "Link = workers arriving to meet job demand.",
    explain: "Factory growth created jobs; immigrants arrived to fill labor needs, contributing to mass immigration and diversity."
  },
  {
    cause: "Technological innovations made production more efficient as machines replaced human labor.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Factories increased output and relied more on machine-based production.",
      B: "Skilled labor became more important than ever in mass production.",
      C: "Production slowed because machines were banned in workplaces.",
      D: "The U.S. economy returned to a predominance of agricultural workers."
    },
    effect: "Industrial production expanded and the economy shifted toward factory work.",
    answer: "A",
    hint: "Machines → efficiency → more output.",
    explain: "New machines increased efficiency and output, strengthening industrial production and accelerating the shift toward factory work."
  },
  {
    cause: "The mechanized assembly line and mass production expanded during industrialization.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Factories increasingly replaced skilled tasks with repetitive, standardized work.",
      B: "Workers moved from unskilled to highly specialized artisan labor.",
      C: "Mass production required fewer factories and less output overall.",
      D: "Most industries stopped using machines to protect skilled trades."
    },
    effect: "There was a transition from skilled to unskilled labor in many industries.",
    answer: "A",
    hint: "Assembly line = repetitive tasks.",
    explain: "Assembly lines break work into simple steps, reducing the need for skilled labor and increasing unskilled, repetitive jobs."
  },
  {
    cause: "Laissez-faire policies limited government regulation of big business.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Corporations were able to grow rapidly with limited oversight.",
      B: "The government immediately broke up large companies to prevent consolidation.",
      C: "Business owners were required to share profits equally with workers.",
      D: "Trusts and monopolies were outlawed before they could form."
    },
    effect: "Monopolies and trusts formed and concentrated economic power.",
    answer: "A",
    hint: "Hands-off policies → fewer limits on business growth.",
    explain: "Limited regulation allowed corporations to expand and consolidate, helping trusts and monopolies form."
  },
  {
    cause: "Laissez-faire policies allowed the formation of monopolies and trusts.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Some corporations controlled markets by reducing competition.",
      B: "Workers gained immediate control of major industries.",
      C: "Small businesses eliminated all large corporations overnight.",
      D: "Government regulation increased sharply and restricted corporate growth."
    },
    effect: "Corporate power expanded and shaped economic life during industrialization.",
    answer: "A",
    hint: "Trusts/monopolies = less competition.",
    explain: "When trusts and monopolies form, competition drops and large companies gain control over markets and prices."
  },
  {
    cause: "Unregulated working conditions included long hours, low wages, and unsafe workplaces.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Workers organized to address workplace problems through labor unions.",
      B: "Factory owners reduced hours and raised wages without pressure.",
      C: "Workplace hazards ended because machines were removed from factories.",
      D: "Employees stopped working for wages and returned to rural farms."
    },
    effect: "Labor organizations grew amidst unregulated working conditions.",
    answer: "A",
    hint: "Bad conditions → organizing.",
    explain: "Unsafe conditions and low pay pushed workers to organize, fueling the growth of labor unions."
  },
  {
    cause: "Conflict between corporations and labor increased during industrialization.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Labor unions grew to push for workplace reforms.",
      B: "All strikes ended because workers were satisfied with conditions.",
      C: "Corporations eliminated factories to avoid disagreements.",
      D: "Workers gained voting rights in company elections to choose owners."
    },
    effect: "Organized labor expanded and demanded change in workplaces.",
    answer: "A",
    hint: "Conflict → unions grow.",
    explain: "Disputes over wages, hours, and safety contributed to union growth and increased labor demands."
  },
  {
    cause: "Labor unions advocated for workplace reforms.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "They pushed for shorter work days, increased pay, safer conditions, and restrictions on child labor.",
      B: "They demanded fewer safety rules and longer workdays.",
      C: "They focused only on ending all public transportation in cities.",
      D: "They urged workers to avoid collective action and accept employer decisions."
    },
    effect: "Labor reform became a major issue in industrial workplaces.",
    answer: "A",
    hint: "The link is the specific reforms list.",
    explain: "Union advocacy centered on hours, pay, safety, and child labor restrictions—core workplace reform goals."
  },
  {
    cause: "Labor unions used collective bargaining to negotiate with employers.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Workers negotiated as a group to seek better pay and working conditions.",
      B: "Employers refused to speak with any workers at all.",
      C: "Government outlawed negotiation and required individual contracts only.",
      D: "Unions ended all discussion and relied only on voting in elections."
    },
    effect: "Collective action increased pressure on employers to consider reforms.",
    answer: "A",
    hint: "Collective bargaining = negotiating as a group.",
    explain: "Collective bargaining lets workers negotiate together, increasing leverage for improved wages and conditions."
  },
  {
    cause: "Labor unions used strikes and boycotts to achieve their goals.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Work stoppages and consumer pressure disrupted business operations.",
      B: "Workers increased production to reward factory owners.",
      C: "Unions avoided any action that could affect profits.",
      D: "Boycotts increased sales for targeted companies."
    },
    effect: "Employers often faced economic pressure to respond to labor demands.",
    answer: "A",
    hint: "Strikes/boycotts are economic pressure tools.",
    explain: "Strikes stop labor; boycotts reduce sales—both pressure employers by impacting profits."
  },
  {
    cause: "Business owners resisted labor organizing and union demands.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Labor organizations sometimes faced violent backlash and government intervention.",
      B: "Employers immediately granted all union requests without conflict.",
      C: "Unions gained control of the federal government overnight.",
      D: "Factory owners stopped hiring and ended industrial production nationwide."
    },
    effect: "Labor conflicts sometimes escalated into violence and public attention.",
    answer: "A",
    hint: "Backlash + intervention is the key idea.",
    explain: "Union efforts often met resistance that could turn violent, sometimes prompting government involvement."
  },
  {
    cause: "Mass immigration increased in the United States at the turn of the 20th century.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Immigrants helped fill labor demand and influenced city growth.",
      B: "Immigration ended because there were no jobs in industrial centers.",
      C: "Cities stopped growing because immigrants only lived on farms.",
      D: "Immigration caused factories to close due to labor shortages."
    },
    effect: "American life changed through greater diversity and expanding cities.",
    answer: "A",
    hint: "Immigration connected to jobs and cities.",
    explain: "Immigrants filled job demand and contributed to urban growth and cultural change."
  },
  {
    cause: "Mass immigration made the country more diverse.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Ethnic traits diffused into American culture through food, language, and traditions.",
      B: "All cultural differences disappeared immediately upon arrival.",
      C: "Immigrants were legally required to abandon all traditions and languages.",
      D: "Immigration reduced cultural diversity and eliminated ethnic neighborhoods."
    },
    effect: "American culture changed as new traditions became part of everyday life.",
    answer: "A",
    hint: "The key phrase is diffusion of ethnic traits.",
    explain: "Immigration increased diversity and spread cultural traits into American life."
  },
  {
    cause: "Mass immigration and rapid city growth created competition for jobs and resources.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Nativist sentiment increased in response to newcomers and change.",
      B: "Nativism disappeared because everyone supported immigration.",
      C: "City populations declined as people returned to farms.",
      D: "Immigrants caused wages to rise equally across all industries immediately."
    },
    effect: "Anti-immigrant attitudes and social tensions increased in many communities.",
    answer: "A",
    hint: "Think reaction against immigrants.",
    explain: "Rapid immigration and change often fueled nativist attitudes and social conflict."
  },
  {
    cause: "Many people left farms for cities seeking greater job opportunities.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Internal migration contributed to the growth of urban areas.",
      B: "Internal migration ended because farm jobs increased everywhere.",
      C: "Cities lost population as factories relocated to rural towns only.",
      D: "Public transportation disappeared, preventing any movement."
    },
    effect: "Urban populations expanded and cities faced new infrastructure pressures.",
    answer: "A",
    hint: "Internal migration → urban growth.",
    explain: "When people move from rural farms to cities for work, urban areas expand and face greater demands."
  },
  {
    cause: "African Americans fled the rural South during the Great Migration.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "They sought to escape discrimination and secure better-paying jobs in the urban North.",
      B: "They moved because segregation had ended completely in the South by 1900.",
      C: "They were forced to relocate by laws requiring northern migration.",
      D: "They left because northern factories stopped hiring workers."
    },
    effect: "Northern cities changed economically and culturally as migration increased.",
    answer: "A",
    hint: "Push + pull: discrimination + jobs.",
    explain: "The Great Migration was driven by escaping discrimination and pursuing better-paying jobs in northern cities."
  },
  {
    cause: "The Great Migration increased the population of northern cities.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Migrants became workers and consumers, changing northern city economies.",
      B: "Northern cities lost jobs because no one worked in factories anymore.",
      C: "Urban culture declined because art and music disappeared.",
      D: "Migration ended city growth by reducing demand for housing."
    },
    effect: "Northern cities were transformed economically through expanded labor and consumption.",
    answer: "A",
    hint: "Economic change: workers + consumers.",
    explain: "The Great Migration reshaped city economies as migrants contributed labor and consumer demand."
  },
  {
    cause: "The Great Migration created new African American urban communities.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Culture expanded through art, music, and literature in northern cities.",
      B: "Cultural life ended because cities banned all public performance.",
      C: "Migration reduced cultural expression by eliminating neighborhoods.",
      D: "Migrants avoided cities and returned immediately to rural life."
    },
    effect: "Northern cities changed culturally as new communities influenced American culture.",
    answer: "A",
    hint: "Look for “art, music, and literature.”",
    explain: "Migration supported cultural growth and influence through new communities and creative expression."
  },
  {
    cause: "Urbanization changed the physical nature of cities.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Buildings became taller and tenement buildings provided housing for working families.",
      B: "Cities replaced tall buildings with farms and open fields.",
      C: "All families lived in single houses with large yards in city centers.",
      D: "Urban housing disappeared as people stopped moving to cities."
    },
    effect: "Cities expanded upward and housing density increased.",
    answer: "A",
    hint: "The link names the physical change.",
    explain: "Urbanization often meant taller buildings and tenements to house working families in dense city areas."
  },
  {
    cause: "Rapid city growth created overcrowded housing and limited sanitation services.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Disease spread more easily and living conditions worsened in some neighborhoods.",
      B: "Overcrowding eliminated crime and improved public health immediately.",
      C: "Sanitation improvements always kept pace with population growth.",
      D: "Overcrowding reduced demand for housing and lowered city populations."
    },
    effect: "Urban areas experienced increased disease and poor living conditions.",
    answer: "A",
    hint: "Overcrowding + lack of sanitation → disease.",
    explain: "Crowding and inadequate sanitation contributed to disease and worsening living conditions in rapidly growing cities."
  },
  {
    cause: "Large numbers of immigrants settled in the same urban areas.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Ethnic neighborhoods emerged as groups lived near shared language, culture, and support networks.",
      B: "Immigrants were evenly distributed so ethnic neighborhoods never formed.",
      C: "Cities outlawed neighborhoods based on cultural identity.",
      D: "Immigrants moved only to isolated rural farmland far from cities."
    },
    effect: "Many cities developed distinct cultural districts and communities.",
    answer: "A",
    hint: "Look for “emergence of ethnic neighborhoods.”",
    explain: "As immigrants clustered for support and familiarity, ethnic neighborhoods formed and shaped city life."
  },
  {
    cause: "Urban populations grew and people needed to travel to work efficiently.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Public transportation improved to move larger numbers of commuters.",
      B: "Transportation was eliminated, preventing commuting.",
      C: "Cities banned commuting to reduce congestion.",
      D: "Workers were required to live inside factories."
    },
    effect: "Cities became more connected and commuters could travel for employment and leisure.",
    answer: "A",
    hint: "Growth → transportation improvements.",
    explain: "Urban growth increased demand for transit, leading to improvements that enabled commuting and city expansion."
  },
  {
    cause: "A growing middle class could commute for employment and leisure activities.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "People increasingly lived farther from workplaces while still participating in city economies.",
      B: "Commuting ended because transportation no longer existed.",
      C: "Middle-class growth reduced city connections and travel.",
      D: "Commuters refused to work and returned only to rural farming."
    },
    effect: "Urban life expanded beyond downtown centers as commuting became easier.",
    answer: "A",
    hint: "Commuting changes where people can live.",
    explain: "As commuting became possible, people could live farther from workplaces, reshaping the geography of urban life."
  },
  {
    cause: "Industrialization increased demand for natural resources.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Westward migration increased as Americans sought land and resources.",
      B: "Americans moved eastward away from resources and land.",
      C: "Resource demand ended, reducing settlement pressures.",
      D: "The government banned settlement in all western territories immediately."
    },
    effect: "Continued settlement intensified conflict over land in the West.",
    answer: "A",
    hint: "Resources → migration → conflict.",
    explain: "Demand for resources encouraged westward movement, increasing competition for land and leading to conflict."
  },
  {
    cause: "New technologies transformed production and daily life.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Innovations like the telephone and incandescent light bulb changed communication and living patterns.",
      B: "Technology declined and the U.S. returned to pre-industrial methods.",
      C: "Factories stopped producing because inventions reduced efficiency.",
      D: "Cities grew smaller because technology eliminated the need for work."
    },
    effect: "Economic and social life modernized as new inventions spread.",
    answer: "A",
    hint: "Pick the option that names real industrial-era inventions.",
    explain: "Industrial-era inventions reshaped communication and daily routines, contributing to modernization."
  },
  {
    cause: "Skyscrapers and taller buildings became common in expanding cities.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Cities could house more people and businesses in limited space.",
      B: "Cities ran out of space and were forced to shut down completely.",
      C: "Taller buildings prevented any economic activity from occurring.",
      D: "Urban areas returned to rural living patterns."
    },
    effect: "Urban centers increased density and economic activity.",
    answer: "A",
    hint: "Upward growth = more space in the same footprint.",
    explain: "Taller buildings allowed cities to concentrate housing and business, increasing density and economic development."
  },
  {
    cause: "Crowded urban neighborhoods developed faster than city services could expand.",
    prompt: "Choose the BEST link in the chain.",
    options: {
      A: "Crime, disease, and poor living conditions increased in some areas.",
      B: "City growth eliminated social problems by itself.",
      C: "Overcrowding guaranteed cleaner water and better sanitation.",
      D: "Public services always expanded ahead of population growth."
    },
    effect: "Urbanization created serious challenges for infrastructure and public health.",
    answer: "A",
    hint: "This is the “problems list” from urbanization.",
    explain: "Rapid growth often outpaced services, increasing overcrowding, disease, and other urban challenges."
  }
];


  function $(id){ return document.getElementById(id); }

  var state = {
    player:"",
    startISO:null,
    endISO:null,
    order:[],
    idx:0,
    correct:0,
    misses:0,
    missedSet:{},
    attemptThis:0,
    locked:false,
    timer:null
  };

  function nowISO(){ return new Date().toISOString(); }
  function fmt(dt){ return new Date(dt).toLocaleString(); }

  function shuffle(arr){
    var a = arr.slice();
    for(var i=a.length-1;i>0;i--){
      var j = Math.floor(Math.random()*(i+1));
      var t=a[i]; a[i]=a[j]; a[j]=t;
    }
    return a;
  }

  function calcAcc(){
    var totalQ = questions.length;
    var perfectCorrect = totalQ - state.misses;
    var acc = Math.round((perfectCorrect / totalQ) * 100);
    if(acc<0) acc=0; if(acc>100) acc=100;
    return acc;
  }

  function updateKPIs(){
    $("nameOut").textContent = state.player || "—";
    $("scoreOut").textContent = state.correct + " / " + questions.length;
    $("accOut").textContent = calcAcc() + "%";
    $("progOut").textContent = state.idx + " / " + questions.length;
  }

  function showFeedback(type, title, text){
    var box = $("feedback");
    box.style.display = "block";
    box.className = "msg " + type;
    $("fbTitle").textContent = title;
    $("fbText").textContent = text;
  }
  function hideFeedback(){ $("feedback").style.display = "none"; }

  function setHint(text){
    var hb = $("hintBox");
    if(!text){
      hb.style.display = "none";
      hb.textContent = "";
      return;
    }
    hb.style.display = "block";
    hb.textContent = "Hint: " + text;
  }

  function disableChoices(disabled){
    var btns = $("choices").querySelectorAll("button.choice");
    for(var i=0;i<btns.length;i++) btns[i].disabled = disabled;
  }

  function updateFinishLock(){
    var acc = calcAcc();
    var doneAll = state.idx >= questions.length;
    var mastery = doneAll && acc === 100;
    $("btnFinish").disabled = !mastery;

    if(doneAll){
      if(mastery){
        showFeedback("good","Mastery reached","100% accuracy across the full run. Click Finish / Submit.");
      }else{
        showFeedback("warn","Run complete — not mastery",
          "You finished the run, but accuracy is " + acc + "%. Start a new randomized run and try again.");
      }
    }
  }

  function advance(){
    state.idx++;
    updateKPIs();
    if(state.idx >= questions.length){
      disableChoices(true);
      setHint("");
      updateFinishLock();
      return;
    }
    renderQuestion();
  }

  function renderQuestion(){
    hideFeedback();
    setHint("");
    state.attemptThis = 0;
    $("attemptThis").textContent = "0";

    var qIndex = state.order[state.idx];
    var q = questions[qIndex];

    $("qNum").textContent = String(state.idx + 1);
    $("qTotal").textContent = String(questions.length);
    $("stem").textContent = q.stem;
    $("tag").textContent = q.tag;

    var keys = ["A","B","C","D"];
    var html = "";
    for(var i=0;i<keys.length;i++){
      var k = keys[i];
      html += '<button class="choice" data-key="' + k + '"><strong>' + k + '.</strong> ' + q.choices[k] + '</button>';
    }
    $("choices").innerHTML = html;

    var btns = $("choices").querySelectorAll("button.choice");
    for(var j=0;j<btns.length;j++){
      btns[j].addEventListener("click", function(){
        if(state.locked) return;
        checkAnswer(this.getAttribute("data-key"));
      });
    }

    updateKPIs();
  }

  function checkAnswer(choice){
    var qIndex = state.order[state.idx];
    var q = questions[qIndex];

    state.attemptThis++;
    $("attemptThis").textContent = String(state.attemptThis);

    var correctNow = (choice === q.answer);

    if(correctNow){
      state.correct = Math.min(questions.length, state.correct + 1);
      updateKPIs();

      disableChoices(true);
      state.locked = true;

      var firstTry = (state.attemptThis === 1);
      clearTimeout(state.timer);

      if(firstTry){
        showFeedback("good","Correct (first try)", q.explain || "Correct.");
        state.timer = setTimeout(function(){
          state.locked = false;
          disableChoices(false);
          advance();
        }, 3000);
      }else{
        showFeedback("good","Correct (after hint)", q.explain || "Correct.");
        state.timer = setTimeout(function(){
          state.locked = false;
          disableChoices(false);
          advance();
        }, 800);
      }
      return;
    }

    // wrong: count miss once per question
    if(!state.missedSet[qIndex]){
      state.missedSet[qIndex] = true;
      state.misses++;
      updateKPIs();
    }

    showFeedback("bad","Not yet","Use the hint and try again. Your accuracy will reflect this miss.");
    setHint(q.hint || "Re-read the stem and eliminate two choices first.");
  }

  function startRun(){
    var idxs = [];
    for(var i=0;i<questions.length;i++) idxs.push(i);
    state.order = shuffle(idxs);
    state.idx = 0;
    state.correct = 0;
    state.misses = 0;
    state.missedSet = {};
    state.attemptThis = 0;
    state.locked = false;
    clearTimeout(state.timer);
    state.timer = null;

    state.startISO = nowISO();
    state.endISO = null;

    $("finish").style.display = "none";
    renderQuestion();
  }

  function finishRun(){
    state.endISO = nowISO();
    var acc = calcAcc();
    var mastery = (acc === 100 && state.idx >= questions.length);

    $("summaryLine").textContent = mastery
      ? "Mastery earned. Show this screen to your teacher."
      : "Not mastery. Start a new randomized run and try again.";

    $("summaryCode").textContent =
      "NAME: " + state.player + "\n" +
      "GAME: Game 7 — OST Simulation Mixer\n" +
      "DATE: " + new Date(state.startISO).toLocaleDateString() + "\n" +
      "START: " + fmt(state.startISO) + "\n" +
      "END: " + fmt(state.endISO) + "\n" +
      "QUESTIONS: " + questions.length + "\n" +
      "MISSES: " + state.misses + "\n" +
      "ACCURACY: " + acc + "%\n" +
      "MASTERY: " + (mastery ? "YES" : "NO") + "\n";

    $("finish").style.display = "block";
    $("choices").innerHTML = "";
    setHint("");
  }

  document.addEventListener("DOMContentLoaded", function(){
    $("btnStart").addEventListener("click", function(){
      var name = $("nameIn").value.trim();
      if(!name){ alert("Please enter your name to begin."); return; }
      state.player = name;
      $("gate").style.display = "none";
      $("game").style.display = "block";
      startRun();
    });

    $("btnRestart").addEventListener("click", function(){
      if(confirm("Restart with a new randomized run?")) startRun();
    });

    $("btnFinish").addEventListener("click", finishRun);
    $("btnNewRun").addEventListener("click", startRun);

    updateKPIs();
  });

})();
</script>
</body>
</html>

